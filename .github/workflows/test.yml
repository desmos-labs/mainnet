name: Test

on:
  pull_request:

jobs:
  gentxs:
    name: Gentxs validity
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2

      - name: Setup Python 🐍
        uses: actions/setup-python@v2
        with:
          python-version: '3.9.5'

      - name: Check gentxs validity ✅
        run: |
          pip3 install -r scripts/requirements.txt
          python scripts/check-gentx.py "$GITHUB_WORKSPACE/gentxs" "$GITHUB_WORKSPACE/penultimate_genesis.json"

  genesis:
    name: Genesis validity
    runs-on: ubuntu-latest
    needs:
      - gentxs
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2

      - name: Setup Desmos 💿
        run: |
          wget -O desmos https://github.com/desmos-labs/desmos/releases/download/v1.0.0/desmos-1.0.0-linux-amd64
          chmod +x ./desmos
          ./desmos init test

      - name: Check genesis validaty ✅
        run: |
          cp penultimate_genesis.json ~/.desmos/config/genesis.json
          cp -a gentxs/. ~/.desmos/config/gentx/

          echo "Collecting genesis transactions"
          ./desmos collect-gentxs > final-genesis.json
          ./desmos collect-gentxs > final-genesis.json 2>&1

          echo "Verifying genesis"
          ./desmos validate-genesis final-genesis.json


